
{% if inventory_hostname == groups['master'][0] %}
# Bootstrap master node (first master)
token: {{ token }}
cni: {{ cni }}
disable:
{% for addon in disable_addons %}
  - {{ addon }}
{% endfor %}
write-kubeconfig-mode: "{{ write_kubeconfig_mode }}"
{% if tls_sans is defined and tls_sans | length > 0 %}
tls-san:
{% for san in tls_sans %}
  - {{ san }}
{% endfor %}
{% endif %}

{% elif 'master' in group_names %}
# HA master node
token: {{ token }}
server: {{ loadbalancer_apiserver }}:{{ loadbalancer_apiserver_port | default('6443') }}
cni: {{ cni }}
disable:
{% for addon in disable_addons %}
  - {{ addon }}
{% endfor %}
write-kubeconfig-mode: "{{ write_kubeconfig_mode }}"
{% if tls_sans is defined and tls_sans | length > 0 %}
tls-san:
{% for san in tls_sans %}
  - {{ san }}
{% endfor %}

{% elif 'agent' in group_names %}
# Agent node configuration
token: {{ token }}
server: {{ loadbalancer_apiserver }}:{{ loadbalancer_apiserver_port | default('6443') }}
{% if node_role_label %}
node-label: "{{ node_role_label }}"
{% endif %}
{% endif %}